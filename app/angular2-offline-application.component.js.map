{"version":3,"file":"angular2-offline-application.component.js","sourceRoot":"","sources":["angular2-offline-application.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component } from '@angular/core';\nimport { DsInputComponent } from './ds-input';\nimport { DsListComponent } from './ds-list';\n\nimport 'vendor/firebase/firebase.js';\ndeclare var firebase;\n\nexport interface IListItem {\n  message: string,\n}\n\n\n@Component({\n  moduleId: module.id,\n  selector: 'angular2-offline-application-app',\n  templateUrl: 'angular2-offline-application.component.html',\n  styleUrls: ['angular2-offline-application.component.css'],\n  directives: [DsInputComponent, DsListComponent]\n})\nexport class Angular2OfflineApplicationAppComponent {\n\n  public listItems: IListItem[] = [];\n  public rawData: any = {};\n  public messageRef;\n  public connectionRef;\n  public isOnline = true;\n  public isPersistingData = false;\n  public gettingPersistingData = false;\n  constructor() {\n\n    var config = {\n      apiKey: \"AIzaSyBmxmlZUo_cvikhAgA0GLfD0OOkWM1IJxw\",\n      authDomain: \"offline-application-41a3e.firebaseapp.com\",\n      databaseURL: \"https://offline-application-41a3e.firebaseio.com\",\n      storageBucket: \"offline-application-41a3e.appspot.com\",\n    };\n    firebase.initializeApp(config);\n\n    this.messageRef = firebase.database().ref('/messages');\n\n    this.initDisconnectListener()\n    this.initChildAddedListener();\n  }\n\n  initDisconnectListener() {\n    console.log('initDisconnectListener');\n    firebase.database().ref('.info/connected').on('value', (connectedSnap) => {\n      console.log(connectedSnap.val());\n      if (connectedSnap.val() === true) {\n        this.isOnline = true;\n      } else {\n        this.isOnline = false;\n        if (!this.listItems.length) setTimeout(() => this.getPersistedData(), 1000);\n      }\n    });\n  }\n\n\n  initChildAddedListener() {\n    this.messageRef.on('child_added', (snapshot) => {\n      console.log('child_added');\n      this.listItems.unshift(snapshot.val());\n      if (this.isPersistingData) return;\n      setTimeout(() => this.persistData(), 1000);\n      this.isPersistingData = true;\n    });\n  }\n\n\n  persistData() {\n    localStorage.setItem('listItems', JSON.stringify(this.listItems));\n    this.isPersistingData = false;\n  }\n\n\n  getPersistedData() {\n    if(this.isOnline) return;\n    console.log('getPersistedData');\n    this.listItems = JSON.parse(localStorage.getItem('listItems')) || [];\n  }\n\n  sendMessage(event) {\n    let item: IListItem = {\n      message: event.message,\n    }\n    this.messageRef.push(item);\n  }\n}\n"]}