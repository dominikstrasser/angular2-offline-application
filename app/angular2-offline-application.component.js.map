{"version":3,"file":"angular2-offline-application.component.js","sourceRoot":"","sources":["angular2-offline-application.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, ViewEncapsulation } from '@angular/core';\nimport { HTTP_PROVIDERS } from '@angular/http';\nimport { DsInputComponent } from './ds-input';\nimport { DsListComponent } from './ds-list';\nimport { DsTutorialComponent } from './ds-tutorial';\nimport { DsLoginComponent } from './ds-login';\nimport 'vendor/firebase/firebase.js';\ndeclare var firebase;\n\nexport interface IListItem {\n  message?: string,\n  key?: string,\n  name?: string\n}\n\n\n@Component({\n  moduleId: module.id,\n  selector: 'angular2-offline-application-app',\n  templateUrl: 'angular2-offline-application.component.html',\n  styleUrls: ['angular2-offline-application.component.css'],\n  directives: [DsInputComponent, DsListComponent, DsTutorialComponent, DsLoginComponent],\n  providers: [HTTP_PROVIDERS],\n  encapsulation: ViewEncapsulation.None\n})\nexport class Angular2OfflineApplicationAppComponent {\n\n  public listItems: IListItem[] = [];\n  public rawData: any = {};\n  public messageRef;\n  public connectionRef;\n  public isOnline = true;\n  public isPersistingData = false;\n  public isTutorialHidden = true;\n  public isLoggedIn = false;\n\n  constructor() { }\n\n  ngOnInit() {\n    var config = {\n      apiKey: \"AIzaSyBmxmlZUo_cvikhAgA0GLfD0OOkWM1IJxw\",\n      authDomain: \"offline-application-41a3e.firebaseapp.com\",\n      databaseURL: \"https://offline-application-41a3e.firebaseio.com\",\n      storageBucket: \"offline-application-41a3e.appspot.com\",\n    };\n    firebase.initializeApp(config);\n\n    this.messageRef = firebase.database().ref('/messages');\n\n    this.initDisconnectListener()\n    this.initChildAddedListener();\n    this.initChildRemovedListener();\n    this.initAuthListener();\n  }\n\n  initAuthListener() {\n    firebase.auth().onAuthStateChanged((user) => {\n      if (user) {\n        this.isLoggedIn = true;\n      } else {\n        this.isLoggedIn = false;\n      }\n    });\n  }\n\n  initDisconnectListener() {\n    firebase.database().ref('.info/connected').on('value', (connectedSnap) => {\n      if (connectedSnap.val() === true) {\n        this.isOnline = true;\n      } else {\n        this.isOnline = false;\n        if (!this.listItems.length) setTimeout(() => this.getPersistedData(), 2000);\n      }\n    });\n  }\n\n  onLogin(result) {\n    var credential = firebase.auth.GithubAuthProvider.credential(result.credential.accessToken);\n    firebase.auth().signInWithCredential(credential).catch(function (error) {\n      console.log(error);\n    });\n  }\n\n  onRemove(item) {\n    this.messageRef.child(item.key).remove();\n  }\n\n  toggleTutorial() {\n    this.isTutorialHidden = !this.isTutorialHidden;\n  }\n\n  initChildAddedListener() {\n    this.messageRef.on('child_added', (snapshot) => {\n      let item: IListItem = {\n        message: snapshot.val().message,\n        name: snapshot.val().name,\n        key: snapshot.key\n      }\n      this.listItems.unshift(item);\n      if (this.isPersistingData) return;\n      setTimeout(() => this.persistData(), 1000);\n      this.isPersistingData = true;\n    });\n  }\n\n  initChildRemovedListener() {\n    this.messageRef.on('child_removed', (snapshot) => {\n      let item: IListItem = {\n        key: snapshot.key\n      }\n      let index = this.getIndexForKey(item.key);\n      this.listItems.splice(index, 1);\n      if (this.isPersistingData) return;\n      setTimeout(() => this.persistData(), 1000);\n      this.isPersistingData = true;\n    });\n  }\n\n  getIndexForKey(_key) {\n    for (let i = 0; i < this.listItems.length; i++) {\n      if(_key == this.listItems[i].key) return i\n    }\n    return -1;\n  }\n\n\n  persistData() {\n    localStorage.setItem('listItems', JSON.stringify(this.listItems));\n    this.isPersistingData = false;\n  }\n\n\n  getPersistedData() {\n    if (this.isOnline) return;\n    this.listItems = JSON.parse(localStorage.getItem('listItems')) || [];\n  }\n\n\n  sendMessage(item: IListItem) {\n    item.name = firebase.auth().currentUser.displayName;\n    this.messageRef.push(item);\n  }\n}\n"]}